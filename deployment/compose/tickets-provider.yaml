# yaml-language-server: $schema=https://goauthentik.io/blueprints/schema.json
version: 1
metadata:
    name: Example - Tickets App + OAuth2 provider
entries:
    -   id: my-oauth2-provider
        model: authentik_providers_oauth2.oauth2provider
        state: present
        identifiers:
            name: "Tickets OAuth2"
        attrs:
            client_id: "my-client-id"
            client_secret: "my-client-secret"
            client_type: confidential
            issuer_mode: per_provider
            redirect_uris:
                -   url: http://localhost:8000/api/oauth2-redirect.html
                    matching_mode: strict
                -   url: http://127.0.0.1:8000/api/oauth2-redirect.html
                    matching_mode: strict
            signing_key: !Find [ authentik_crypto.certificatekeypair, [ name, "authentik Self-signed Certificate" ] ]
            authentication_flow: !Find [ authentik_flows.flow, [ slug, default-authentication-flow ] ]
            authorization_flow: !Find [ authentik_flows.flow, [ slug, default-provider-authorization-implicit-consent ] ]
            invalidation_flow: !Find [ authentik_flows.flow, [ slug, default-provider-invalidation-flow ] ]
            property_mappings:
                - !Find [ authentik_providers_oauth2.scopemapping, [ name, "authentik default OAuth Mapping: OpenID 'openid'" ] ]
                - !Find [ authentik_providers_oauth2.scopemapping, [ name, "authentik default OAuth Mapping: OpenID 'email'" ] ]
                - !Find [ authentik_providers_oauth2.scopemapping, [ name, "authentik default OAuth Mapping: OpenID 'profile'" ] ]

    -   id: tickets-app
        model: authentik_core.application
        state: present
        identifiers:
            slug: "tickets-app"
        attrs:
            name: "Tickets App"
            provider: !KeyOf my-oauth2-provider
            meta_launch_url: "http://localhost:8000/api/"
